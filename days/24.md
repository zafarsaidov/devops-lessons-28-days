[Main](../README.md)
---

# Kubernetes Practice Lab: Helm Installation and Usage

This independent lab introduces Helm, the Kubernetes package manager. Students will learn how to install Helm, add repositories, explore charts, and manage applications via Helm.

---

## ğŸ¯ Objectives

* Install Helm
* Add popular Helm chart repositories
* Explore available charts
* Install and manage a Helm release (Redis or RabbitMQ)
* Uninstall a release and clean up
* Practice common Helm commands

---

## â›³ Prerequisites

* A running Kubernetes cluster (e.g., Minikube, Kind, cloud-based)
* `kubectl` installed and configured
* Internet access for downloading Helm binaries and Helm chart repositories

---

## ğŸ”§ Step 1: Install Helm CLI

### MacOS

```bash
brew install helm
```

### Linux

```bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```

### Verify Installation

```bash
helm version
```

---

## ğŸ“¦ Step 2: Add Helm Repositories

Add some common and widely-used repositories:

```bash
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
```

Check added repos:

```bash
helm repo list
```

---

## ğŸ” Step 3: Explore Charts

Search for charts by name:

```bash
helm search repo redis
helm search repo rabbitmq
```

Inspect a chartâ€™s default values:

```bash
helm show values bitnami/redis
```

---

## ğŸš€ Step 4: Install a Helm Chart

### Example: Install Redis with default values

```bash
helm install my-redis bitnami/redis \
  --namespace helm-lab \
  --create-namespace
```

Check deployment status:

```bash
kubectl get all -n helm-lab
```

List Helm releases:

```bash
helm list -n helm-lab
```

---

## âš™ï¸ Step 5: Upgrade and Uninstall Helm Release

### Upgrade (e.g., change replica count or set password)

```bash
helm upgrade my-redis bitnami/redis \
  --namespace helm-lab \
  --set architecture=replication \
  --set replica.replicaCount=2
```

### Uninstall

```bash
helm uninstall my-redis -n helm-lab
```

Delete the namespace:

```bash
kubectl delete ns helm-lab
```

---

## ğŸ” Step 6: Frequently Used Helm Commands

### Preview rendered manifests

```bash
helm template my-redis bitnami/redis > rendered.yaml
```

### Dry-run an install

```bash
helm install --dry-run --debug my-redis bitnami/redis
```

### Show default values

```bash
helm show values bitnami/redis
```

### Show chart README

```bash
helm show readme bitnami/redis
```

### List all installed charts

```bash
helm list -A
```

### Get values of a release

```bash
helm get values my-redis -n helm-lab
```

### Save custom values to file and install

```bash
helm show values bitnami/redis > myvalues.yaml
# edit myvalues.yaml
helm install custom-redis bitnami/redis -f myvalues.yaml --namespace helm-lab
```

---

## ğŸ§ª Optional Tasks

1. Install RabbitMQ using Helm with custom values
2. Use `helm diff` (plugin) to preview changes before upgrade
3. Practice rollback:

   ```bash
   helm rollback my-redis 1 -n helm-lab
   ```

---

## âœ… Conclusion

Youâ€™ve successfully used Helm to:

* Install the CLI
* Add and update repositories
* Install, upgrade, and uninstall charts
* Customize deployments with Helm values
* Practice common Helm commands



# Kubernetes Helm Lab: Chart Structure and Templating Logic

This lab focuses purely on practice. Students will create and analyze Helm charts from scratch, exploring structure, templates, values, and commands.

â¸»

ğŸ¯ Objectives
* Understand Helm chart folder structure
* Use templates and values.yaml
* Learn basic Helm commands for install, upgrade, inspect, and delete
* Dive into Chart.yaml metadata
* Edit common template files (Deployment, Service, NOTES.txt)

â¸»

## ğŸ›  Step 1: Create a New Helm Chart

```bash
helm create myapp
cd myapp
```
âœ… Explanation: This generates a sample chart with templates/, values.yaml, and boilerplate files.

Explore the structure:
```bash
ls -R
```

â¸»

## ğŸ“‚ Step 2: Chart Folder Structure

![alt text](image.png)


â¸»

## ğŸ§¾ Step 3: Customize Chart Metadata

Edit Chart.yaml:
```yaml
apiVersion: v2
name: myapp
version: 0.1.0
appVersion: "1.0"
description: A simple Helm chart for deploying NGINX
keywords:
  - web
  - nginx
type: application
maintainers:
  - name: DevOps Student
    email: student@example.com
```
âœ… Explanation:
* name: name of the chart
* version: Helm chart version (not the app version)
* appVersion: container image version
* type: application or library
* maintainers: optional metadata

â¸»

## ğŸ§¾ Step 4: Edit values.yaml
```yaml
replicaCount: 2
image:
  repository: nginx
  pullPolicy: IfNotPresent
  tag: "1.25"
service:
  type: ClusterIP
  port: 80
```
âœ… Explanation:
* These are referenced in the templates as .Values.<key>

â¸»

## ğŸ“„ Step 5: Modify templates/deployment.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "myapp.fullname" . }}
  labels:
    app: {{ include "myapp.name" . }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "myapp.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "myapp.name" . }}
    spec:
      containers:
      - name: {{ .Chart.Name }}
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        ports:
        - containerPort: {{ .Values.service.port }}
```
âœ… Explanation:
* {{ .Values.replicaCount }}: pulls from values.yaml
* include helper uses logic from _helpers.tpl
* {{ .Chart.Name }} references the chart name directly

â¸»

## ğŸ“„ Step 6: Modify templates/service.yaml
```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ include "myapp.fullname" . }}
spec:
  type: {{ .Values.service.type }}
  selector:
    app: {{ include "myapp.name" . }}
  ports:
    - protocol: TCP
      port: {{ .Values.service.port }}
      targetPort: {{ .Values.service.port }}
```
âœ… Explanation:
* This exposes the NGINX app via a service using values

â¸»

## ğŸ“ Step 7: Modify templates/NOTES.txt

1. Get the application URL:
```bash
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app={{ include "myapp.name" . }}" -o jsonpath="{.items[0].metadata.name}")
  echo "Visit http://127.0.0.1:8080 to access the app"
  kubectl port-forward $POD_NAME 8080:80
```
âœ… Explanation:
* This message is shown after helm install

â¸»

## ğŸ” Step 8: Preview Rendered YAML
```bash
helm template myapp .
```
âœ… Explanation: Shows raw Kubernetes YAML from templates and values

â¸»

## ğŸš€ Step 9: Install to Kubernetes
```bash
helm install myapp . -n helm-lab --create-namespace
```
Verify:
```bash
helm list -n helm-lab
kubectl get all -n helm-lab
```

â¸»

## ğŸ”„ Step 10: Upgrade with New Values

Edit values.yaml:
```yaml
replicaCount: 3
```
Apply:
```bash
helm upgrade myapp . -n helm-lab
```
â¸»

## ğŸ§ª Step 11: Dry Run + Debug
```bash
helm upgrade --install myapp . -n helm-lab --dry-run --debug
```
âœ… See rendered templates and test without applying.

â¸»

## ğŸ—‘ï¸ Step 12: Uninstall and Cleanup
```bash
helm uninstall myapp -n helm-lab
kubectl delete ns helm-lab
```

â¸»

## âœ… Summary

You practiced:
* Helm chart structure and metadata
* Template editing: Deployment, Service, NOTES
* Referencing values in templates
* Using key Helm commands: install, upgrade, template, status, uninstall

ğŸ¯ This prepares you for deeper Helm templating and logic.

# Helm Practice: values.yaml and Template Helpers

This lab is focused entirely on understanding `values.yaml` and the `_helpers.tpl` file in Helm.

---

## ğŸ¯ Objectives

* Understand how `values.yaml` is used in templates
* Create and reference template helpers
* Practice using `--set` and `--values` overrides
* Use `helm template` to debug rendering
* Learn commonly used filters like `nindent`, `quote`, `toYaml`

---

## ğŸ›  Step 1: Create a New Helm Chart

```bash
helm create webapp
cd webapp
```

---

## ğŸ“‚ Step 2: Explore Chart Structure

```text
webapp/
â”œâ”€â”€ Chart.yaml
â”œâ”€â”€ values.yaml
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ _helpers.tpl
```

âœ… `values.yaml` holds default values for parameters used in templates.

---

## ğŸ§¾ Step 3: Edit values.yaml

```yaml
replicaCount: 2
image:
  repository: nginx
  tag: "1.25"
  pullPolicy: IfNotPresent
service:
  type: ClusterIP
  port: 80
fullnameOverride: ""
nameOverride: ""
```

---

## ğŸ”§ Step 4: Create \_helpers.tpl

```gotpl
{{- define "webapp.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" -}}
{{- end }}

{{- define "webapp.fullname" -}}
{{- if .Values.fullnameOverride -}}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}
{{- else -}}
{{- printf "%s-%s" .Release.Name (include "webapp.name" .) | trunc 63 | trimSuffix "-" -}}
{{- end -}}
{{- end }}
```

### ğŸ” Explanation

* `define` ... `end`: Declares a named template that can be reused.
* `default .Chart.Name .Values.nameOverride`: If `nameOverride` is empty, use the chart name.
* `trunc 63`: Ensures the name doesn't exceed 63 characters (Kubernetes label limit).
* `trimSuffix "-"`: Removes trailing dashes.
* `printf "%s-%s"`: Combines release name and app name.
* `include "webapp.name" .`: Calls another defined template and passes current context (`.`).

These helpers ensure consistent naming throughout your templates.

---

## ğŸ“¦ Step 5: Use helpers in deployment.yaml

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "webapp.fullname" . }}
  labels:
    app: {{ include "webapp.name" . }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "webapp.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "webapp.name" . }}
    spec:
      containers:
      - name: nginx
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
        imagePullPolicy: {{ .Values.image.pullPolicy }}
        ports:
        - containerPort: {{ .Values.service.port }}
```

---

## ğŸ§ª Step 6: Install chart and override values

```bash
helm install webapp . -n helm-lab --create-namespace \
  --set replicaCount=3 \
  --set image.tag=1.26 \
  --set nameOverride=nginx-lab
```

âœ… Verify overrides:

```bash
helm get values webapp -n helm-lab
helm get manifest webapp -n helm-lab
```

---

## ğŸ” Step 7: Use `helm template` to render chart

```bash
helm template webapp . \
  --set replicaCount=1 \
  --set image.repository=nginx \
  --set image.tag=1.27
```

âœ… This shows the rendered Kubernetes manifests without installing.

---

## ğŸ”¤ Step 8: Use Helm Filters (Functions)

Update `deployment.yaml` to use filters:

```yaml
labels:
  app: {{ include "webapp.name" . | quote }}
  chart: {{ .Chart.Name | upper }}
  values: {{ .Values | toYaml | nindent 2 }}
```

### ğŸ” Filter Explanations

* `quote`: Wraps value in double quotes.
* `upper`: Converts string to uppercase.
* `toYaml`: Converts a map/object to YAML format.
* `nindent N`: Adds N spaces before every line of the YAML output (used for nesting).

These filters make complex objects easier to embed into YAML.

---

## ğŸ§¹ Step 9: Cleanup

```bash
helm uninstall webapp -n helm-lab
kubectl delete ns helm-lab
```

---

## âœ… Summary

You practiced:

* Using and overriding `values.yaml`
* Creating helper functions in `_helpers.tpl`
* Referencing helpers in templates
* Using filters: `quote`, `toYaml`, `nindent`
* Rendering charts with `helm template`
* Installing charts with dynamic values

ğŸ¯ This foundational knowledge sets you up for using conditions, loops, and advanced templating in future lessons.


# Helm Practice Lab: Conditionals, Loops, and Hooks

This hands-on lab explores advanced Helm templating features:

* Conditionals (`if`, `else`, `with`)
* Loops (`range`)
* Lifecycle Hooks (`helm.sh/hook`, `hook-weight`, `hook-delete-policy`)

Each concept is demonstrated with examples from simple to more complex use cases.

---

## ğŸ¯ Objectives

* Understand Helm `if`, `else`, `with` blocks
* Use `range` to iterate over values
* Write templates with conditional rendering
* Use Helm lifecycle hooks to control execution timing

---

## ğŸ§± Step 1: Scaffold chart

```bash
helm create advanced-webapp
cd advanced-webapp
```

---

## ğŸ“ Initial Deployment Template

Create or edit `templates/deployment.yaml`:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "advanced-webapp.fullname" . }}
  labels:
    app: {{ include "advanced-webapp.name" . }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "advanced-webapp.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "advanced-webapp.name" . }}
    spec:
      containers:
        - name: {{ .Chart.Name }}
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - containerPort: {{ .Values.service.port }}
```

This will serve as the base deployment file, and weâ€™ll incrementally enhance it in each task.

---

## ğŸ” Step 2: Conditionals (`if`, `else`, `with`)

### âœ… Use Case: Enable/Disable Sidecar

In `values.yaml`:

```yaml
sidecar:
  enabled: true
  name: log-watcher
  image: busybox
```

In `deployment.yaml`:

```yaml
      {{- if .Values.sidecar.enabled }}
      - name: {{ .Values.sidecar.name }}
        image: {{ .Values.sidecar.image }}
        command: ["sh", "-c", "tail -F /var/log/app.log"]
      {{- end }}
```

âœ… Try disabling sidecar:

```bash
helm template . --set sidecar.enabled=false
```

---

### âœ… Use Case: `with` block

```yaml
{{- with .Values.image }}
image: "{{ .repository }}:{{ .tag }}"
imagePullPolicy: {{ .pullPolicy }}
{{- end }}
```

âœ… `with` sets context to nested object and shortens paths.

---

## ğŸ”‚ Step 3: Loops (`range`)

### âœ… Use Case: Add custom labels

In `values.yaml`:

```yaml
customLabels:
  team: devops
  owner: alice
  environment: lab
```

In `deployment.yaml`:

```yaml
metadata:
  labels:
    {{- range $key, $val := .Values.customLabels }}
    {{ $key }}: {{ $val | quote }}
    {{- end }}
```

âœ… Use `range` to iterate key/value pairs.

---

### âœ… Use Case: Multiple ports

In `values.yaml`:

```yaml
containerPorts:
  - name: http
    containerPort: 80
  - name: metrics
    containerPort: 9100
```

In container spec:

```yaml
ports:
  {{- range .Values.containerPorts }}
  - name: {{ .name }}
    containerPort: {{ .containerPort }}
  {{- end }}
```

âœ… You can `range` over lists too.

---

## ğŸ” Step 4: Combine Conditionals + Loops

Use this in `service.yaml`:

```yaml
{{- if .Values.service.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "advanced-webapp.fullname" . }}
spec:
  selector:
    app: {{ include "advanced-webapp.name" . }}
  ports:
    {{- range .Values.service.ports }}
    - port: {{ .port }}
      targetPort: {{ .targetPort }}
      protocol: {{ .protocol | default "TCP" }}
    {{- end }}
{{- end }}
```

---

## â›“ Step 5: Helm Hooks

Hooks allow you to run templates at specific release lifecycle points.

### âœ… Use Case: Create init Job to prepare DB

In `templates/job-init-db.yaml`:

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: init-db
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  template:
    spec:
      containers:
      - name: migrate
        image: postgres:14
        command: ["sh", "-c", "echo Running DB migrations..."]
      restartPolicy: Never
```

### ğŸ” Explanation

* `pre-install`, `pre-upgrade`: Job runs before install/upgrade
* `hook-delete-policy`: Deletes old job before new one is created, and after success

âœ… Apply and verify:

```bash
helm install advapp . --dry-run --debug
helm install advapp .
kubectl get jobs
```

---

## ğŸ“‹ Summary

âœ… You practiced:

* Helm conditionals (`if`, `else`, `with`)
* Loops (`range`) for lists and maps
* Combining `range` with `if` for dynamic templates
* Creating lifecycle hooks with annotations

ğŸ“ These techniques allow flexible and robust Helm chart development.

Use `helm template .` to test every combination safely before install!



[Main](../README.md)
---