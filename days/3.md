[Main](../README.md)
---

## **Lesson Plan: System Administration Fundamentals**

### **1. User and Group Management**

**Useful Information:**
* Linux is a multi-user system where every user has a unique **UID** (User ID) and belongs to one or more **groups** with **GIDs** (Group IDs).
* **Primary Group:** The default group for a user (stored in `/etc/passwd`)
* **Supplementary Groups:** Additional groups a user belongs to (stored in `/etc/group`)
* Key files: `/etc/passwd`, `/etc/group`, `/etc/shadow`, `/etc/gshadow`

**Commands & Practice:**

```bash
# View current user information
id                            # Show current user's UID, GID, and groups
whoami                        # Show current username
who                           # Show logged-in users
w                             # Show logged-in users and what they're doing

# User management (requires sudo)
sudo useradd john             # Create a new user
sudo passwd john              # Set password for john
sudo userdel john             # Delete user (without home directory)
sudo userdel -r john          # Delete user and home directory

# Group management
sudo groupadd developers      # Create a new group
sudo groupdel developers      # Delete a group
sudo usermod -aG developers student1  # Add user to supplementary group
sudo gpasswd -d student1 developers   # Remove user from group

# Practice Task 1:
# 1. Create a new user 'alice' with a home directory and set her password
# 2. Create a group 'webadmins'
# 3. Add both 'alice' and your student user to 'webadmins'
# 4. Verify the group membership using 'id' and 'groups' commands
```

**Advanced User Management:**

```bash
# Create user with specific UID and custom shell
sudo useradd -u 1501 -s /bin/bash -c "Developer Account" bob

# Modify existing user
sudo usermod -s /bin/zsh bob          # Change shell
sudo usermod -L bob                   # Lock account
sudo usermod -U bob                   # Unlock account
sudo chage -l bob                     # Check password aging info

# View system files
cat /etc/passwd                       # User accounts
cat /etc/group                        # Group definitions
sudo cat /etc/shadow                  # Encrypted passwords (root only)

# Practice Task 2:
# 1. Examine the /etc/passwd file and find your user's entry
# 2. Create a user 'tempuser' with UID 2000 and no login shell (-s /bin/false)
# 3. Lock the 'tempuser' account and verify it's locked
# 4. Set password expiration for 'tempuser' to 45 days
```

**Best Practices:**
* Use `-aG` with `usermod` to append to groups, not replace
* Regularly review `/etc/passwd` for unauthorized users
* Use `visudo` for safe sudo privileges management
* Implement password policies with `chage`

**Use Cases:**
* Onboarding new team members
* Creating service accounts for applications
* Setting up access control for shared resources
* Temporary contractor accounts

---

### **2. Linux Package Management**

**Useful Information:**
* Package managers handle software installation, updates, and removal.
* **APT** (Debian/Ubuntu): `apt`, `apt-get`, `apt-cache`
* **YUM/DNF** (RHEL/CentOS): `yum`, `dnf`
* **RPM** (Red Hat): Low-level package manager
* **DPKG** (Debian): Low-level package manager

**APT (Debian/Ubuntu) Commands & Practice:**

```bash
# Update package lists
sudo apt update

# Upgrade installed packages
sudo apt upgrade
sudo apt full-upgrade        # More comprehensive upgrade

# Search for packages
apt search "web server"
apt-cache search nginx

# Install packages
sudo apt install nginx curl wget

# Remove packages
sudo apt remove nginx        # Remove package but keep config files
sudo apt purge nginx         # Remove package and config files
sudo apt autoremove          # Remove unused dependencies

# Package information
apt show nginx               # Show package details
dpkg -l | grep nginx         # List installed packages matching pattern
dpkg -L nginx                # List files installed by a package

# Practice Task 3:
# 1. Update your package lists
# 2. Search for available text editors (vim, nano, emacs)
# 3. Install 'htop' and 'tree' packages
# 4. Check what files were installed by 'tree' package
```

**YUM/DNF (RHEL/CentOS) Equivalent:**

```bash
# YUM commands (older RHEL/CentOS)
sudo yum update
sudo yum install nginx
sudo yum remove nginx
yum search "web server"

# DNF commands (newer versions)
sudo dnf update
sudo dnf install nginx
sudo dnf remove nginx
dnf search "web server"
```

**Managing Repositories:**

```bash
# List configured repositories
apt-cache policy              # Show repository priorities
cat /etc/apt/sources.list     # Main repository list
ls /etc/apt/sources.list.d/   # Additional repository files

# Add a repository (example: Docker)
sudo apt install apt-transport-https ca-certificates curl gnupg
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list
sudo apt update

# Practice Task 4:
# 1. Check what repositories are configured on your system
# 2. Install a package from a different repository (if available)
# 3. Check if there are any held back packages
```

**Best Practices:**
* Always run `apt update` before installing packages
* Use `apt upgrade` regularly for security updates
* Test upgrades in non-production environments first
* Be cautious with third-party repositories

---

### **3. Linux Process and Job Management**

**Useful Information:**
* **Process:** A running instance of a program
* **PID:** Process ID (unique number)
* **PPID:** Parent Process ID
* **Foreground jobs:** Run in current terminal, block input
* **Background jobs:** Run independently, don't block terminal

**Process Monitoring Commands:**

```bash
# Basic process monitoring
ps                           # Show current shell processes
ps aux                       # Show all processes with details
ps -ef                       # Show full format listing
ps aux --sort=-%mem          # Sort by memory usage
ps aux --sort=-%cpu          # Sort by CPU usage

# Real-time monitoring
top                          # Interactive process viewer
htop                         # Enhanced top (if installed)
iotop                        # I/O monitoring

# Process tree
pstree                       # Show process tree
pstree -p                    # Show process tree with PIDs

# Practice Task 5:
# 1. Run 'ps aux' and identify the PID of your shell
# 2. Use 'top' to monitor processes, then sort by CPU and memory
# 3. Install and try 'htop' for a better interface
# 4. Use 'pstree' to see the process hierarchy
```

**Process Control & Signals:**

```bash
# Starting processes
sleep 60                     # Run in foreground
sleep 60 &                   # Run in background (note the ampersand)
./my_script.sh &             # Run script in background

# Job control
jobs                         # List background jobs
fg %1                        # Bring job 1 to foreground
bg %1                        # Continue job 1 in background

# Process signals
kill 1234                    # Send TERM signal (graceful shutdown)
kill -9 1234                 # Send KILL signal (force terminate)
kill -15 1234                # Send TERM signal (same as default)
kill -STOP 1234              # Pause process
kill -CONT 1234              # Continue paused process

# Finding and killing processes
pgrep sshd                   # Find PIDs by name
pkill sshd                   # Kill processes by name
killall process_name         # Kill all processes with name

# Practice Task 6:
# 1. Start 'sleep 300' in the background
# 2. Start another 'sleep 200' in the background
# 3. List your background jobs
# 4. Bring the first sleep to foreground, then stop it with Ctrl+Z
# 5. Continue it in background with 'bg'
# 6. Kill both sleep processes
```

**Best Practices:**
* Try `kill` (TERM) before `kill -9` (KILL)
* Use `htop` for better process visualization
* Monitor system resources regularly
* Understand parent-child process relationships

---

### **4. Scheduled Tasks & Kernel Parameters**

**Scheduled Tasks with Cron:**

**Useful Information:**
* **Cron:** Time-based job scheduler
* **Crontab:** File containing schedule of cron entries
* Format: `minute hour day month day_of_week command`

**Cron Practice:**

```bash
# Manage crontab
crontab -l                    # List current user's cron jobs
crontab -e                    # Edit current user's cron jobs
crontab -r                    # Remove all cron jobs

# System-wide cron
sudo cat /etc/crontab         # System crontab (different format)
ls /etc/cron.d/               # Additional cron configurations

# Cron examples in crontab -e:
# * * * * *  command to execute
# │ │ │ │ │
# │ │ │ │ └── Day of week (0-6) (0 is Sunday, or use names)
# │ │ │ └──── Month (1-12)
# │ │ └────── Day of month (1-31)
# │ └──────── Hour (0-23)
# └────────── Minute (0-59)

# Common cron patterns:
* * * * *  /path/to/command   # Every minute
0 * * * *  /path/to/command   # Every hour at :00
0 2 * * *  /path/to/command   # Daily at 2:00 AM
0 2 * * 0  /path/to/command   # Weekly on Sunday at 2:00 AM
0 2 1 * *  /path/to/command   # Monthly on 1st at 2:00 AM

# Practice Task 7:
# 1. Open your crontab with 'crontab -e'
# 2. Add a job that appends the date to a file every minute:
#    * * * * * date >> ~/cron_test.log
# 3. Wait 2 minutes and check ~/cron_test.log
# 4. Remove the cron job
```

**Systemd Timers (Modern Alternative):**

```bash
# List timers
systemctl list-timers

# Create a systemd timer (requires service unit + timer unit)
sudo systemctl edit --full --force my-backup.timer
```

**Kernel Parameters with sysctl:**

**Useful Information:**
* Kernel parameters control system behavior at runtime
* Located in `/proc/sys/` (virtual filesystem)
* Modified temporarily via `/proc/sys/` or permanently via `/etc/sysctl.conf`

**Kernel Parameters Practice:**

```bash
# View current kernel parameters
sysctl -a                     # Show all parameters
sysctl kernel.hostname        # Show specific parameter
cat /proc/sys/kernel/hostname # Alternative way

# Common parameters to check
sysctl net.ipv4.ip_forward
sysctl kernel.threads-max
sysctl vm.swappiness

# Temporary modification
sudo sysctl -w kernel.hostname="new-hostname"
sudo sysctl -w net.ipv4.ip_forward=1

# Permanent modification
sudo nano /etc/sysctl.conf
# Add: net.ipv4.ip_forward=1
sudo sysctl -p                # Reload from /etc/sysctl.conf

# Practice Task 8:
# 1. Check the current value of 'vm.swappiness'
# 2. Temporarily change it to 10
# 3. Check available system memory with 'free -h'
# 4. Examine other interesting parameters in /proc/sys/
```

**Best Practices:**
* Test cron jobs thoroughly - they run in a minimal environment
* Redirect cron output to files or use MAILTO
* Document kernel parameter changes
* Backup `/etc/sysctl.conf` before major changes
* Use comments in crontab for documentation

---

## **Homework Assignment: System Administration**

**Instructions:** Complete all tasks and document your work in `~/homework_system_admin/`. Create a script `setup_report.sh` that demonstrates your solutions.

**Tasks:**

1. **User & Group Management (30 points)**
   Create a script `user_setup.sh` that:
   - Creates three users: `web_user`, `db_user`, `app_user`
   - Creates two groups: `developers` and `admins`
   - Assigns `web_user` and `app_user` to `developers` group
   - Assigns `db_user` to `admins` group
   - Sets different login shells for each user
   - Creates a shared directory `/opt/shared` with permissions so:
     - `developers` group can read/write
     - `admins` group can read/write/delete
     - Others have no access

2. **Package Management & Service Setup (25 points)**
   - Install `nginx` web server using your distribution's package manager
   - Configure it to start automatically on boot
   - Create a custom welcome page at `/var/www/html/index.html`
   - Write a script `service_monitor.sh` that:
     - Checks if nginx is running
     - Checks if it's enabled to start on boot
     - Reports the service status and version of nginx installed

3. **Process Management Script (20 points)**
   Create a script `process_manager.sh` that:
   - Monitors for processes using more than 50% CPU
   - Lists the top 5 memory-consuming processes
   - Provides functionality to safely kill a process by name (with confirmation)
   - Runs in a loop every 10 seconds until stopped

4. **Automated Backup System with Cron (25 points)**
   Create a backup system that:
   - Has a script `auto_backup.sh` that backs up `/home` to `/backups` with timestamp
   - Uses `tar` with compression
   - Implements log rotation (keep only last 7 backups)
   - Sets up a cron job to run daily at 2:00 AM
   - Includes a configuration file for backup settings

**Example Starter for process_manager.sh:**
```bash
#!/bin/bash

monitor_processes() {
    echo "=== Top 5 Memory-Consuming Processes ==="
    ps aux --sort=-%mem | head -6
    
    echo -e "\n=== High CPU Processes (>50%) ==="
    ps aux --sort=-%cpu | awk 'NR>1 && $3 > 50 {print $2 " " $11 " " $3 "%"}'
}

kill_process_by_name() {
    read -p "Enter process name to kill: " proc_name
    # TODO: Add confirmation and killing logic
}

while true; do
    clear
    monitor_processes
    echo -e "\nOptions:"
    echo "1) Kill process by name"
    echo "2) Refresh"
    echo "3) Exit"
    read -p "Choose option: " choice
    
    case $choice in
        1) kill_process_by_name ;;
        2) continue ;;
        3) break ;;
        *) echo "Invalid option" ;;
    esac
    sleep 10
done
```

**Submission Requirements:**
- All scripts in `~/homework_system_admin/`
- `README.md` with explanations and usage instructions
- Screenshots or output samples showing your working solutions
- Crontab entry for the backup system

**Bonus Challenge:**
Create a systemd service and timer that replaces the cron job for backups, providing better logging and dependency management.

This homework will test their skills in user management, package installation, process monitoring, and task automation - essential for any Linux system administrator!

[Main](../README.md)
---