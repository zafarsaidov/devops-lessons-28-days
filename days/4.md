[Main](../README.md)
---

## **Lesson Plan: Networking & Remote Access**

### **1. SSH & Remote Access**

**Useful Information:**
* **SSH (Secure Shell):** Encrypted protocol for secure remote access
* Uses public-key cryptography for authentication
* Default port: 22
* Key components: `ssh` (client), `sshd` (server), key pairs (public/private)

**SSH Client Commands & Practice:**

```bash
# Basic SSH connection
ssh student1@localhost                  # Connect to local machine
ssh student1@192.168.1.100              # Connect to remote server
ssh -p 2222 student1@192.168.1.100      # Connect on non-standard port

# SSH with specific identity file
ssh -i ~/.ssh/my_key student1@server    # Use specific private key

# SSH with X11 forwarding (for GUI applications)
ssh -X student1@server                  # Enable X11 forwarding

# SSH with command execution
ssh student1@server "ls -la"            # Run command and exit
ssh student1@server "tail -f /var/log/syslog"  # Run continuous command

# Practice Task 1:
# 1. SSH into your own account on the local machine
# 2. Try SSHing to a neighbor's account (if permissions allow)
# 3. Run a remote command: ssh student1@localhost "whoami; pwd"
# 4. Test X11 forwarding: ssh -X student1@localhost "xeyes" (if GUI available)
```

**SSH Key Management:**

```bash
# Generate SSH key pair
ssh-keygen -t rsa -b 4096 -C "student1@training"  # RSA 4096-bit
ssh-keygen -t ed25519 -C "student1@training"      # Ed25519 (more secure)

# Copy public key to remote server
ssh-copy-id student1@server
# Or manually:
cat ~/.ssh/id_rsa.pub | ssh student1@server "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"

# SSH agent for key management
eval "$(ssh-agent -s)"                 # Start SSH agent
ssh-add ~/.ssh/id_rsa                  # Add private key to agent
ssh-add -l                             # List loaded keys

# Practice Task 2:
# 1. Generate an ED25519 SSH key pair
# 2. Copy your public key to your own account (localhost)
# 3. Verify you can SSH without password
# 4. Set proper permissions: chmod 700 ~/.ssh && chmod 600 ~/.ssh/authorized_keys
```

**SSH Server Configuration:**

```bash
# SSH server configuration file
sudo nano /etc/ssh/sshd_config

# Important directives to understand:
# Port 22
# PermitRootLogin no
# PasswordAuthentication yes
# PubkeyAuthentication yes
# AllowUsers student1 student2
# DenyUsers baduser
# X11Forwarding yes

# Check SSH server status
sudo systemctl status ssh
sudo systemctl restart ssh
sudo systemctl reload ssh    # Reload configuration without dropping connections

# View SSH connections
ss -tlnp | grep :22          # Check if SSH is listening
who                          # See who's logged in
last                         # See login history

# Practice Task 3:
# 1. Examine your sshd_config file
# 2. Change the SSH port to 2222 (temporarily for practice)
# 3. Restart SSH service and connect using the new port
# 4. Change it back to port 22
```

**Best Practices:**
* Use key-based authentication instead of passwords
* Disable root login over SSH
* Use non-standard ports in production (but security through obscurity isn't enough)
* Regularly update SSH keys
* Use fail2ban to prevent brute force attacks

---

### **2. Port Forwarding**

**Useful Information:**
* **Port Forwarding:** Redirecting network traffic from one port to another
* **Local Forwarding:** Forward remote service to local machine
* **Remote Forwarding:** Forward local service to remote machine

**Local Port Forwarding:**

```bash
# Forward remote service to local port
ssh -L 8080:localhost:80 student1@server    # Access server's port 80 via localhost:8080
ssh -L 3306:localhost:3306 student1@db_server  # Forward MySQL database

# With gateway server
ssh -L 8080:target_server:80 student1@gateway  # Through jump host

# Practice Task 4:
# 1. If you have a web server running, forward its port 80 to your local 8080
# 2. Access it via: http://localhost:8080
# 3. Forward SSH through the same connection: ssh -L 2222:localhost:22 user@server
```

**Remote Port Forwarding:**

```bash
# Forward local service to remote port
ssh -R 9090:localhost:3000 student1@server  # Your local port 3000 available on server:9090

# Useful for exposing local development server
ssh -R 8080:localhost:8000 student1@public_server  # Show local work to others

# Practice Task 5:
# 1. Start a simple Python web server: python3 -m http.server 8000
# 2. Use remote forwarding to expose it on a classmate's machine
# 3. Have them access your local server through the tunnel
```

**SSH Config File for Easier Management:**

```bash
# Create ~/.ssh/config
nano ~/.ssh/config
```

```
# Example SSH config
Host myserver
    HostName 192.168.1.100
    User student1
    Port 22
    IdentityFile ~/.ssh/id_ed25519

Host gateway
    HostName jump.example.com
    User student1
    LocalForward 8080 internal-server:80

Host *.internal
    User admin
    ProxyJump gateway
```

**Best Practices:**
* Use SSH config file for frequently accessed hosts
* Understand the security implications of port forwarding
* Close tunnels when not in use
* Use `-N` flag for port forwarding without shell: `ssh -N -L 8080:localhost:80 user@server`

---

### **3. Linux Networking Essentials**

**Network Interface Management:**

**Useful Information:**
* **Network Interfaces:** Physical or virtual network connections
* **eth0:** Traditional Ethernet interface naming
* **ens33, enp0s3:** Predictable network interface names (systemd)
* **lo:** Loopback interface (localhost)

**Network Commands & Practice:**

```bash
# View network interfaces
ip addr show                    # Modern replacement for ifconfig
ip link show                    # Show interface status
ls /sys/class/net/              # List available interfaces

# Configure network interfaces
sudo ip addr add 192.168.1.100/24 dev eth0    # Add IP address
sudo ip link set eth0 up                       # Bring interface up
sudo ip link set eth0 down                     # Bring interface down

# Practice Task 7:
# 1. List all network interfaces and their IP addresses
# 2. Identify your main network interface and its MAC address
# 3. Check if an interface is up or down
```

**Routing and Connectivity:**

```bash
# Routing table
ip route show                   # Show routing table
ip route add default via 192.168.1.1          # Add default gateway
ip route add 192.168.2.0/24 via 192.168.1.1   # Add specific route

# Network connectivity testing
ping 8.8.8.8                   # Test connectivity to IP
ping google.com                # Test DNS resolution and connectivity
traceroute google.com          # Trace path to destination
mtr google.com                 # Continuous traceroute (if installed)

# Practice Task 8:
# 1. Check your default gateway
# 2. Trace the route to google.com
# 3. Test connectivity to both IP and domain name
```

**DNS Configuration:**

```bash
# DNS resolution
cat /etc/resolv.conf           # DNS resolver configuration
systemd-resolve --status       # Show DNS configuration (systemd)
dig google.com                 # DNS lookup tool
nslookup google.com            # Alternative DNS lookup

# Testing DNS
host google.com
systemd-resolve google.com

# Practice Task 9:
# 1. Check your current DNS servers
# 2. Use dig to query different record types: A, MX, NS
# 3. Change your DNS temporarily by modifying /etc/resolv.conf
```

**Network Services and Ports:**

```bash
# Listening services
ss -tuln                       # Show all listening ports
netstat -tuln                  # Traditional way (if installed)
lsof -i :22                    # Show what's using port 22

# Firewall management (UFW - Uncomplicated Firewall)
sudo ufw status                # Check firewall status
sudo ufw enable                # Enable firewall
sudo ufw allow 22/tcp          # Allow SSH
sudo ufw allow 80/tcp          # Allow HTTP
sudo ufw deny 3306/tcp         # Deny MySQL
sudo ufw delete allow 80/tcp   # Remove rule

# Practice Task 10:
# 1. Check what services are listening on your system
# 2. Enable UFW firewall if available
# 3. Allow SSH and HTTP ports, then check status
```

**Network Troubleshooting Toolkit:**

```bash
# Comprehensive network check
ip addr show                   # Interface status
ip route show                  # Routing table
ss -tuln                       # Listening services
ping -c 4 8.8.8.8             # Basic connectivity
dig google.com                 # DNS resolution
traceroute google.com          # Path analysis
sudo tcpdump -i any port 22    # Packet capture (for advanced troubleshooting)

# Practice Task 11:
# 1. Create a script that performs a complete network diagnostic
# 2. The script should check: interfaces, routing, DNS, and basic connectivity
# 3. Save the output to a file with timestamp
```

**Best Practices:**
* Use `ip` command instead of deprecated `ifconfig` and `route`
* Regularly monitor network services and open ports
* Implement firewall rules following least privilege principle
* Use packet capture tools (tcpdump, wireshark) for advanced troubleshooting
* Document network configurations and changes

---

## **Homework Assignment: Networking & Remote Access**

**Instructions:** Complete all tasks and document your work in `~/homework_networking/`. Create a comprehensive report of your setup.

**Tasks:**

1. **SSH Server Hardening (30 points)**
   Create a script `secure_ssh.sh` that:
   - Backs up the original sshd_config
   - Implements security best practices:
     * Change default port to 2222
     * Disable root login
     * Disable password authentication (key-only)
     * Limit user access to specific accounts
     * Set idle timeout
   - Restarts SSH service and tests the configuration
   - Provides rollback functionality

2. **Advanced SSH Tunneling Setup (25 points)**
   Create a tunneling system that:
   - Uses SSH config file for host management
   - Sets up local forwarding to access a "restricted" web service
   - Implements remote forwarding to share a local service
   - Creates a dynamic SOCKS proxy for secure browsing
   - Includes documentation on how to use each tunnel

3. **Network Diagnostic Tool (25 points)**
   Develop a script `network_diagnostic.sh` that:
   - Checks all network interfaces and their status
   - Verifies DNS resolution and connectivity
   - Identifies all listening services
   - Tests port connectivity to common services (HTTP, SSH, etc.)
   - Generates a comprehensive report with recommendations

4. **Multi-Hop SSH Access (20 points)**
   Set up a bastion host configuration where:
   - Students can SSH through a "jump host" to access other student machines
   - Implement SSH key forwarding for seamless access
   - Create SSH config entries for easy connection
   - Document the access pattern and security considerations

**Example Starter for secure_ssh.sh:**
```bash
#!/bin/bash

BACKUP_DIR="/etc/ssh/backup"
CURRENT_DATE=$(date +%Y%m%d_%H%M%S)

backup_sshd_config() {
    sudo mkdir -p $BACKUP_DIR
    sudo cp /etc/ssh/sshd_config "$BACKUP_DIR/sshd_config.$CURRENT_DATE"
    echo "Backup created: $BACKUP_DIR/sshd_config.$CURRENT_DATE"
}

harden_ssh() {
    # Backup current config
    backup_sshd_config
    
    # Apply security settings
    sudo sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config
    sudo sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config
    sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
    
    # TODO: Add more security settings
    echo "SSH hardening completed. Please restart SSH service."
}

rollback() {
    # TODO: Implement rollback to latest backup
    echo "Rollback functionality to be implemented"
}

case "$1" in
    "harden")
        harden_ssh
        ;;
    "rollback")
        rollback
        ;;
    *)
        echo "Usage: $0 {harden|rollback}"
        ;;
esac
```

**Example network_diagnostic.sh structure:**
```bash
#!/bin/bash

echo "=== Network Diagnostic Report ==="
echo "Generated: $(date)"
echo

echo "1. Network Interfaces:"
ip addr show

echo -e "\n2. Routing Table:"
ip route show

echo -e "\n3. Listening Services:"
ss -tuln

echo -e "\n4. Connectivity Test:"
ping -c 2 8.8.8.8

echo -e "\n5. DNS Resolution:"
dig google.com +short
```

**Submission Requirements:**
- All scripts in `~/homework_networking/`
- SSH config file with your tunnel configurations
- Documentation of your security hardening choices
- Output from your network diagnostic tool
- A diagram showing your multi-hop SSH setup

**Bonus Challenge:**
Set up a VPN using WireGuard or OpenVPN and document the configuration process, including key generation, server setup, and client configuration.

This homework will give students practical experience with secure remote access, network troubleshooting, and advanced SSH features - essential skills for managing systems in real-world environments!

[Main](../README.md)
---